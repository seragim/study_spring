<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board.mapper">

<update id="read">
	update board set readcnt = readcnt +1 where id = #{id}
</update>

<select id="view" resultType="board.BoardVO">
	select b.*, (select name from member 
				where member.id=writer) name 
	from board b
	where id = #{id}
</select>

<sql id="search_where">
	<if test="search == 'title' or search == 'content'">
		where ${search} like '%' || #{keyword} || '%'
	</if>
	<if test="search == 'writer'">
		where <include refid="writer_where"/>
	</if>
	<if test="search == 'all'">
		where title like '%' || #{keyword} || '%'
		or content like '%' || #{keyword} || '%'
		or <include refid="writer_where"/>
	</if>
</sql>

<sql id="writer_where">
	writer in (select id from member where name like '%' || #{keyword} || '%')
</sql>

<insert id="insert">
	insert into board(title, content, writer, filename, filepath)
	values(#{title}, #{content}, #{writer}, #{filename, jdbcType=VARCHAR}, #{filepath, jdbcType=VARCHAR})
</insert>

<select id="list" resultType="board.BoardVO">
	select b.*, (select name from member m where m.id=writer) name from
	(select b.*, rownum no from
	(select * from board <include refid="search_where"/>
	order by id) b) b
	where no between #{beginList} and #{endList}
	order by no desc
</select>

<select id="totalList" resultType="integer">
	select count(*) from board <include refid="search_where"/>
</select>

</mapper>